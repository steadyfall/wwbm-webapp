{% extends 'base.html' %}
{% load static tailwind_tags %}
{% load utility %}
{% load humanize %}
{% block content %}
<!-- Modal -->
<div id="lifelineModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-black rounded-lg shadow-lg w-96 p-6">
        <h2 class="text-xl font-bold mb-4">Select a Lifeline</h2>
        <form method="post" id="lifeline" class="max-w-sm mx-auto">
            {% csrf_token %}
            <label for="countries" class="block mb-2 text-sm font-medium text-white">Which lifeline would you like to use?</label>
            <select class="border text-sm rounded-lg block w-full p-2.5 bg-gray-700 border-gray-600 placeholder-gray-400 text-white focus:ring-blue-500 focus:border-blue-500" name="lifeline" id="options">
                {% for life in session.left_lifelines.all %}
                    <option value="{{ life.name }}">{{ life.name }}</option>
                {% endfor %}
            </select>
            <div class="mt-4">
                <span class="text-lg text-gray-200">Brief description of the lifelines:</span>
                <ul class="space-y-1">
                    {% for life in session.left_lifelines.all %}
                    {% if life.name == 'Fifty-50' %}
                        <span title="{{ life.name }}">{% include "lifelineSVG/fifty50.html" %}</span>
                        <li>{{ life.name }} : Remove two incorrect answers.</li>
                    {% elif life.name == 'Audience Poll' %}
                        <span title="{{ life.name }}">{% include "lifelineSVG/audiencePoll.html" %}</span>
                        <li>{{ life.name }} : Show audience poll results.</li>
                    {% elif life.name == 'Expert Answer' %}
                        <span title="{{ life.name }}">{% include "lifelineSVG/expertAnswer.html" %}</span>
                        <li>{{ life.name }} : Get advice from the expert.</li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>
            <input type="hidden" id="timeLeftAfterLifeline" name="timeLeftAfterLifeline" value="">
            <div class="mt-6 flex justify-end space-x-4">
                <button onclick="toggleModal()" id="closeLifeline" type="button" class="bg-red-500 text-white px-4 py-2 rounded-md">Cancel</button>
                <button type="submit" id="confirmLifeline" name="lifelineSubmit" value="yes"
                class="bg-green-500 text-white px-4 py-2 rounded-md"
                >
                    Use Lifeline
                </button>
            </div>
        </form>
    </div>
</div>
<form method="post" id="newform">
    {% csrf_token %}
    <div class="w-full max-w-4xl mx-auto p-4 space-y-6">
        <!-- Top bar -->
        <div class="flex flex-col sm:flex-row justify-between items-center text-white space-y-6 sm:space-y-0">
            <div class="text-lg font-bold">Question for <span class="text-red-500">${{ forAmount|intcomma }}</span></div>
            <div class="flex items-center space-x-4">
                <div class="text-sm sm:text-base">Lifelines:</div>
                <div class="flex space-x-2">
                    {% for life in session.left_lifelines.all %}
                    <span title="{{ life.name }}" class="text-yellow-400">
                        {% if life.name == 'Fifty-50' %}
                            {% include "lifelineSVG/fifty50.html" %}
                        {% elif life.name == 'Audience Poll' %}
                            {% include "lifelineSVG/audiencePoll.html" %}
                        {% elif life.name == 'Expert Answer' %}
                            {% include "lifelineSVG/expertAnswer.html" %}
                        {% endif %}
                    </span>
                    {% empty %}
                    <button onclick="toggleModal()" type="button" id="lifelineButton" disabled
                        class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-md text-sm transition-colors">
                        Use Lifeline
                    </button>
                    {% endfor %}
                </div>
            </div>

            {% if session.left_lifelines.all %}
                <button onclick="toggleModal()" type="button" id="lifelineButton" {% if usedLifelineRecently %}disabled{% endif %}
                    class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-md text-sm transition-colors">
                    Use Lifeline
                </button>
            {% endif %}

            <div class="text-white text-sm sm:text-base">
                <div>Time Left: <span class="font-bold" id="time-left">{{ timer }}</span>s</div>
            </div>
        </div>
        <!-- Question -->
        <div class="bg-blue-900 text-white text-center py-6 px-4 rounded-2xl text-lg sm:text-xl md:text-2xl shadow-lg">
            {{ question.text }}
        </div>
        <!-- Answer options -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {% if option1 %}
            <button class="bg-blue-800 hover:bg-blue-700 text-white py-4 px-6 rounded-xl text-left text-lg transition-colors">
                <span class="text-cyan-400 font-bold mr-2">A.</span> {{ option1 }}
            </button>
            {% endif %}
            {% if option2 %}
            <button class="bg-blue-800 hover:bg-blue-700 text-white py-4 px-6 rounded-xl text-left text-lg transition-colors">
                <span class="text-cyan-400 font-bold mr-2">B.</span> {{ option2 }}
            </button>
            {% endif %}
            {% if option3 %}
            <button class="bg-blue-800 hover:bg-blue-700 text-white py-4 px-6 rounded-xl text-left text-lg transition-colors">
                <span class="text-cyan-400 font-bold mr-2">C.</span> {{ option3 }}
            </button>
            {% endif %}
            {% if option4 %}
            <button class="bg-blue-800 hover:bg-blue-700 text-white py-4 px-6 rounded-xl text-left text-lg transition-colors">
                <span class="text-cyan-400 font-bold mr-2">D.</span> {{ option4 }}
            </button>
            {% endif %}
        </div>
        <!-- Game info and submit button -->
        <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
            <div class="text-white text-sm sm:text-base">
                <div>Total Amount: <span class="font-bold">${{ total|intcomma }}</span></div>
            </div>
            <div class="text-white text-lg">
                Your option is:
                {% if option1 %}
                    <label class="ml-3">
                        <input type="radio" name="userAnswer" id="option_a" value="{{ option1 }}" class="mr-2">
                        A
                    </label>
                {% endif %}
                {% if option2 %}
                    <label class="ml-3">
                        <input type="radio" name="userAnswer" id="option_b" value="{{ option2 }}" class="mr-2">
                        B
                    </label>
                {% endif %}
                {% if option3 %}
                    <label class="ml-3">
                        <input type="radio" name="userAnswer" id="option_c" value="{{ option3 }}" class="mr-2">
                        C
                    </label>
                {% endif %}
                {% if option4 %}
                    <label class="ml-3">
                        <input type="radio" name="userAnswer" id="option_d" value="{{ option4 }}" class="mr-2">
                        D
                    </label>
                {% endif %}
            <div>
            <div class="space-x-4">
                <button class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-md transition-colors"
                    type="submit" title="Exit with collected money" name="submitBtn" value="exit"
                >
                    Exit
                </button>
                <button class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-md transition-colors"
                    type="submit" title="Submit your answer" name="submitBtn" id="sendAnswer" value="yes"
                >
                    Submit
                </button>
            </div>
        </div>
    </div>
</form>
<script defer src="{% static 'js/timer.js' %}"></script>
<script>
    function toggleModal() {
        const modal = document.getElementById('lifelineModal');
        modal.classList.toggle('hidden');
    }

    function useLifeline() {
        toggleModal();
    }
</script>
{% endblock %}
